{% load message_formatting %}
<div id="message-history" class="sf-history h-[56vh] overflow-y-auto rounded-2xl p-3 md:p-4">
    {% if messages %}
        <div class="space-y-3">
            {% for message in messages %}
                <div class="chat {% if message.sender == 'user' %}chat-end{% else %}chat-start{% endif %}">
                    <div class="chat-bubble shadow-md {% if message.sender == 'user' %}sf-bubble-user{% elif message.sender == 'ai' %}sf-bubble-ai{% else %}sf-bubble-system{% endif %}">
                        {% if message.sender == "ai" %}
                            {{ message.content|render_markdown }}
                        {% else %}
                            {{ message.content|linebreaksbr }}
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="flex h-full items-center justify-center text-sm text-slate-300/70">
            Start the conversation by sending your first message.
        </div>
    {% endif %}
</div>

<script>
(function () {
    const history = document.getElementById("message-history");
    if (!history) return;

    requestAnimationFrame(() => {
        history.scrollTop = history.scrollHeight;
    });
})();
</script>
